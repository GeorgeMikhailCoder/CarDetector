close all

speed = 3; % скорость движения в метрах в секунду
heigh = 50; % высота в метрах
alpha = 84; % горизонтальный угол обзора камеры в градусах
beta = 84; % вертикальный угол обзора камеры в градусах
FPS = 24; % частота кадров видеосъёмки
R = 2; % радиус отождествления точек в метрах

mapLength = tand(beta/2)*heigh*2;
mapWidth = tand(alpha/2)*heigh*2;

R = mapLength/camHeigh * R;

% создаем объект для чтения видео
reader = VideoReader('src.mp4');

% покадрово читаем все видео
% функция step будет возвращать матрицу размером Height x Width x  3
% правда элементы этой матрицы будут уже типа single - 4рех байтные числа с плавающей точкой
if ~reader.hasFrame()
    return
end
prevFrame = reader.readFrame();
prevDif = zeros(size(prevFrame));

s = size(prevFrame);
camHeigh = s(1);
camWidth = s(2);

vpx = round(camHeigh/mapLength * speed);
vpx = 1



while reader.hasFrame()
   frame = reader.readFrame();
   difFrame = getDifFrame(frame, prevFrame, vpx);
   
   prevCenters = getCenterMassList(prevDif);
   centers = getCenterMassList(difFrame);
   
   
   imshow(frame);
   if (centers)
   hold on
   plot(centers(:,1), centers(:,2), 'r*')
   hold off
   end
   prevFrame = frame;
   prevDif = difFrame;
   pause(0.001)

end